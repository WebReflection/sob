/*! (C) WebReflection Mit Style License */
define(function(){function E(){var e=s.call(i),n=1e3/h.minFPS,o=!1;y=m.splice(0,m.length);while(y.length){f(y.shift()),o=s.call(i)-e>=n;if(o)break}y.length&&m.unshift.apply(m,y),h.isOverloaded=m.length>v,v=m.length,r&&!o&&g.length&&f(g.shift()),h.debug&&h.isOverloaded&&console.warn("overloaded frame"),m.length||r&&g.length?t(E):(p=!1,h.isOverloaded=p)}function S(){var e=s.call(i),t=1e3/h.minFPS;b=g.splice(0,g.length);while(b.length){f(b.shift());if(s.call(i)-e>=t)break}b.length&&g.unshift.apply(g,b),g.length?n(S):d=!1}var e=window,t=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||function(e){setTimeout(e,16)},n=e.requestIdleCallback,r=!n,i=e.performance||{now:Date.now},s=i.now||i.webkitNow||function(){return(new Date).getTime()},o=function(t,n){return t===this[n]},u=function(t){for(var n=this,r=[],i={id:{},fn:t,ar:r},s=1;s<arguments.length;s++)r[s-1]=arguments[s];return c(n,i)||(n.push(i),i.id)},a=function(t,n){var r=l(t,n),i=-1<r;return i&&t.splice(r,1),i},f=function(t){t.fn.apply(null,t.ar)},l=function(t,n){var r=t.length;while(r--&&t[r].id!==n);return r},c=function(t,n){for(var r=0,i;r<t.length;r++){i=t[r];if(i.fn===n.fn&&i.ar.length===n.ar.length&&i.ar.every(o,n.ar))return i.id}return null},h={debug:!1,isOverloaded:!1,minFPS:60,clear:function(t){void (a(m,t)||a(g,t)||a(y,t)||a(b,t))},frame:function(){return w(),u.apply(m,arguments)},idle:function(){return r?w():d||(d=!0,n(S)),u.apply(g,arguments)}},p=!1,d=!1,v=0,m=[],g=[],y=[],b=[],w=function(){p||(p=!0,t(E))}});